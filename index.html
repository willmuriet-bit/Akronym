<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes">
    <title>Akronym</title>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body, html {
            height: 100%;
            width: 100%;
            font-family: 'Arial', sans-serif;
            overflow: hidden;
            position: fixed;
        }

        body {
            background-image: url('background.jpg');
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        #startPage {
            position: relative;
            width: 100%;
            height: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .rotation-container {
            position: relative;
            width: 300px;
            height: 300px;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .comet-tail {            position: absolute;
            width: 300px;
            height: 300px;
            top: 50%;
            left: 50%;
            margin-top: -150px;
            margin-left: -150px;
            animation: rotateOnEdge 20s linear infinite;
            z-index: 15;
            pointer-events: none;
        }

        .comet-tail::before {
            content: '';
            position: absolute;
            width: 100%;
            height: 100%;
            border-radius: 50%;
            background: conic-gradient(
                from 0deg,
                rgba(0, 255, 255, 1) 0deg,
                rgba(0, 255, 255, 0.9) 20deg,
                rgba(0, 255, 255, 0.7) 40deg,
                rgba(0, 191, 255, 0.5) 60deg,
                rgba(0, 191, 255, 0.3) 80deg,
                rgba(0, 191, 255, 0.15) 100deg,
                transparent 180deg
            );
            filter: blur(15px);
            transform: rotate(-90deg);
        }

        .comet-tail::after {
            content: '';
            position: absolute;
            width: 100%;
            height: 100%;
            border-radius: 50%;
            background: conic-gradient(
                from 0deg,
                rgba(0, 255, 255, 1) 0deg,
                rgba(0, 255, 255, 0.8) 15deg,
                rgba(0, 191, 255, 0.5) 40deg,
                transparent 90deg
            );
            filter: blur(10px);
            transform: rotate(-90deg);
            opacity: 0.9;
        }
        .trail {
            position: absolute;
            width: 100%;
            height: 100%;
            border: 2px dashed rgba(0, 191, 255, 0.5);
            border-radius: 50%;
            box-sizing: border-box;
            z-index: 5;
            box-shadow: 0 0 15px rgba(0, 191, 255, 0.6);
        }

        .start-btn {
            position: relative;
            z-index: 10;
            background: linear-gradient(180deg, #4FD3FF 0%, #00BFFF 40%, #0080FF 100%);
            color: white;
            border: none;
            width: 300px;
            height: 300px;
            border-radius: 50%;
            font-size: 3rem;
            font-weight: bold;
            letter-spacing: 5px;
            cursor: pointer;
            box-shadow: 
                0 10px 30px rgba(0, 0, 0, 0.5),
                0 20px 60px rgba(0, 0, 0, 0.4),
                inset 0 -8px 15px rgba(0, 0, 0, 0.4),
                inset 0 8px 15px rgba(255, 255, 255, 0.5),
                inset 0 0 0 8px rgba(200, 200, 200, 0.8),
                inset 0 0 0 12px rgba(100, 100, 100, 0.6),
                inset 0 0 30px rgba(255, 255, 255, 0.3);
            transition: all 0.3s ease;
            text-shadow: 0 3px 6px rgba(0, 0, 0, 0.4);
            outline: none;
            -webkit-tap-highlight-color: transparent;
            user-select: none;
            -webkit-user-select: none;
        }

        .start-btn:hover {
            transform: scale(1.02);
            box-shadow: 
                0 12px 35px rgba(0, 0, 0, 0.6),
                0 25px 70px rgba(0, 0, 0, 0.5),
                inset 0 -8px 15px rgba(0, 0, 0, 0.4),
                inset 0 8px 15px rgba(255, 255, 255, 0.6),
                inset 0 0 0 8px rgba(200, 200, 200, 0.9),
                inset 0 0 0 12px rgba(100, 100, 100, 0.7),
                inset 0 0 40px rgba(255, 255, 255, 0.4);        }

        .start-btn:active {
            transform: scale(0.98);
        }

        .start-btn:focus,
        .start-btn:focus-visible {
            outline: none;
        }

        @keyframes rotateOnEdge {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        #keyboardPage {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: url('background.jpg');
            background-size: cover;
            background-position: center;
            z-index: 100;
            flex-direction: column;
            align-items: center;
            justify-content: flex-start;
            padding: 5px;
        }

        /* âœ… PROMPTEUR - MAX 4 EMOJIS + ESPACE RÃ‰DUIT */
        #displayArea {
            width: 95vw;
            max-width: 700px;
            min-height: 220px;
            background: rgba(0, 0, 0, 0.7);
            border: 3px solid rgba(0, 191, 255, 0.6);
            border-radius: 15px;
            margin: 10px 0;
            padding: 20px 25px;
            font-size: 5rem;
            color: #00FFFF;
            text-align: center;
            box-shadow: 0 0 40px rgba(0, 191, 255, 0.4);
            display: flex;
            align-items: center;
            justify-content: center;            flex-wrap: nowrap;
            gap: 10px;
            line-height: 1;
            overflow-x: auto;
            overflow-y: hidden;
        }

        /* âœ… EMOJIS - TAILLE UNIFORME */
        .display-card {
            font-size: clamp(7.5rem, 14vw, 11rem);
            display: inline-block;
            line-height: 1;
            min-width: 0;
            flex-shrink: 0;
            white-space: nowrap;
        }

        /* âœ… COULEURS PAR ENSEIGNE */
        .display-card[data-suit="â™¥"],
        .display-card[data-suit="â™¦"] {
            color: #FF0000;
        }

        .display-card[data-suit="â™ "],
        .display-card[data-suit="â™£"] {
            color: #FFFFFF;
        }

        .golden-card {
            color: #00FFFF;
        }

        .display-card.last-card {
            cursor: pointer;
            filter: brightness(1.3);
            transition: all 0.2s ease;
        }

        .display-card.last-card:hover {
            transform: scale(1.1);
            filter: brightness(1.5);
        }

        .display-card.last-card:active {
            transform: scale(0.9);
        }

        .keyboard-container {
            background: rgba(0, 0, 0, 0.6);
            padding: 15px;            border-radius: 15px;
            border: 2px solid rgba(0, 191, 255, 0.4);
            box-shadow: 0 0 50px rgba(0, 191, 255, 0.3);
            width: 95vw;
            max-width: 700px;
        }

        .keyboard-row {
            display: flex;
            justify-content: center;
            margin-bottom: 10px;
            gap: 10px;
            flex-wrap: wrap;
        }

        .key {
            background: rgba(0, 0, 0, 0.8);
            border: 2px solid #00BFFF;
            border-radius: 50%;
            color: white;
            font-size: 2.8rem;
            font-weight: bold;
            width: 80px;
            height: 80px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 0 15px rgba(0, 191, 255, 0.3);
            position: relative;
            overflow: hidden;
            user-select: none;
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            outline: none;
            -webkit-tap-highlight-color: transparent;
            -webkit-focus-ring-color: transparent;
        }

        .key::before {
            content: '';
            position: absolute;
            width: 150%;
            height: 150%;
            border-radius: 50%;
            background: radial-gradient(circle, rgba(0, 191, 255, 0.7) 0%, rgba(0, 191, 255, 0.3) 40%, transparent 70%);
            opacity: 0;
            transform: scale(0.3);
            transition: all 0.3s ease;        }

        .key:hover::before {
            opacity: 1;
            transform: scale(1);
        }

        .key:hover {
            transform: scale(1.1);
            box-shadow: 0 0 40px rgba(0, 191, 255, 0.8), 0 0 60px rgba(0, 191, 255, 0.5);
        }

        .key:active {
            transform: scale(0.95);
        }

        .key:focus,
        .key:focus-visible {
            outline: none;
            box-shadow: 0 0 15px rgba(0, 191, 255, 0.3);
        }

        .key.active-x {
            animation: pulseBlue 2s infinite;
        }

        .key.active-x::before {
            opacity: 1;
            transform: scale(1);
        }

        .key.active-x {
            box-shadow: 0 0 40px rgba(0, 191, 255, 0.8), 0 0 60px rgba(0, 191, 255, 0.5);
        }

        @keyframes pulseBlue {
            0%, 100% {
                box-shadow: 0 0 40px rgba(0, 191, 255, 0.8), 0 0 60px rgba(0, 191, 255, 0.5);
            }
            50% {
                box-shadow: 0 0 60px rgba(0, 191, 255, 1), 0 0 80px rgba(0, 191, 255, 0.7);
            }
        }

        .key.suit {
            font-size: 3.5rem;
        }

        .key.suit::before {
            content: '';            position: absolute;
            width: 150%;
            height: 150%;
            border-radius: 50%;
            opacity: 0;
            transform: scale(0.3);
            transition: all 0.1s ease;
        }

        .key.suit:not(.hearts):not(.diamonds)::before {
            background: radial-gradient(circle, rgba(255, 255, 255, 0.9) 0%, rgba(255, 255, 255, 0.5) 40%, transparent 70%);
        }

        .key.suit:not(.hearts):not(.diamonds):active::before {
            opacity: 1;
            transform: scale(1);
        }

        .key.suit:not(.hearts):not(.diamonds):active {
            transform: scale(0.95);
            box-shadow: 0 0 40px rgba(255, 255, 255, 0.9), 0 0 60px rgba(255, 255, 255, 0.6);
        }

        .key.hearts::before {
            background: radial-gradient(circle, rgba(255, 0, 0, 0.9) 0%, rgba(255, 0, 0, 0.5) 40%, transparent 70%);
        }

        .key.hearts:active::before {
            opacity: 1;
            transform: scale(1);
        }

        .key.hearts:active {
            transform: scale(0.95);
            box-shadow: 0 0 40px rgba(255, 0, 0, 0.9), 0 0 60px rgba(255, 0, 0, 0.6);
        }

        .key.diamonds::before {
            background: radial-gradient(circle, rgba(255, 0, 0, 0.9) 0%, rgba(255, 0, 0, 0.5) 40%, transparent 70%);
        }

        .key.diamonds:active::before {
            opacity: 1;
            transform: scale(1);
        }

        .key.diamonds:active {
            transform: scale(0.95);
            box-shadow: 0 0 40px rgba(255, 0, 0, 0.9), 0 0 60px rgba(255, 0, 0, 0.6);
        }
        .key.active-y {
            animation: pulseY 2s infinite;
        }

        .key.active-y::before {
            opacity: 1;
            transform: scale(1);
        }

        @keyframes pulseY {
            0%, 100% {
                box-shadow: 0 0 40px rgba(255, 255, 255, 0.8), 0 0 60px rgba(255, 255, 255, 0.5);
            }
            50% {
                box-shadow: 0 0 60px rgba(255, 255, 255, 1), 0 0 80px rgba(255, 255, 255, 0.7);
            }
        }

        .key.hearts.active-y {
            animation: pulseYRed 2s infinite;
        }

        @keyframes pulseYRed {
            0%, 100% {
                box-shadow: 0 0 40px rgba(255, 0, 0, 0.8), 0 0 60px rgba(255, 0, 0, 0.5);
            }
            50% {
                box-shadow: 0 0 60px rgba(255, 0, 0, 1), 0 0 80px rgba(255, 0, 0, 0.7);
            }
        }

        .key.hearts {
            color: #FF0000;
            border-color: #FF0000;
            box-shadow: 0 0 15px rgba(255, 0, 0, 0.3);
        }

        .key.diamonds {
            color: #FF0000;
            border-color: #FF0000;
            box-shadow: 0 0 15px rgba(255, 0, 0, 0.3);
        }

        /* âœ… BOUTON PREDICT - DÃ‰SACTIVÃ‰ PAR DÃ‰FAUT */
        .key.predict {
            width: 180px;
            border-radius: 40px;
            font-size: 2rem;
            background: linear-gradient(180deg, rgba(0, 255, 100, 0.3) 0%, rgba(0, 200, 80, 0.3) 100%);            border-color: #00FF64;
            color: #00FF64;
            transition: all 0.5s ease;
            pointer-events: none;
            opacity: 0.5;
            cursor: not-allowed;
        }

        .key.predict.predict-giant {
            font-size: 3rem;
        }

        /* âœ… PREDICT ACTIF - SEULEMENT QUAND 4 EMOJIS DIFFÃ‰RENTS */
        .key.predict.predict-active {
            background: linear-gradient(180deg, rgba(0, 255, 100, 0.6) 0%, rgba(0, 200, 80, 0.6) 100%);
            box-shadow: 0 0 40px rgba(0, 255, 100, 0.8), 0 0 60px rgba(0, 255, 100, 0.5);
            animation: pulsePredict 1.5s infinite;
            pointer-events: auto;
            opacity: 1;
            cursor: pointer;
        }

        @keyframes pulsePredict {
            0%, 100% {
                box-shadow: 0 0 40px rgba(0, 255, 100, 0.8), 0 0 60px rgba(0, 255, 100, 0.5);
            }
            50% {
                box-shadow: 0 0 60px rgba(0, 255, 100, 1), 0 0 80px rgba(0, 255, 100, 0.7);
            }
        }

        .key.predict::before {
            background: radial-gradient(ellipse, rgba(0, 255, 100, 0.7) 0%, rgba(0, 255, 100, 0.3) 40%, transparent 70%);
        }

        .key.predict:hover {
            background: linear-gradient(180deg, rgba(0, 255, 100, 0.5) 0%, rgba(0, 200, 80, 0.5) 100%);
            box-shadow: 0 0 40px rgba(0, 255, 100, 0.8), 0 0 60px rgba(0, 255, 100, 0.5);
        }

        /* PAGE PREDICT */
        #predictPage {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: url('background.jpg');
            background-size: cover;            background-position: center;
            z-index: 200;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }

        .loading-container {
            position: relative;
            width: 200px;
            height: 200px;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .loading-ring {
            position: absolute;
            width: 100%;
            height: 100%;
            border-radius: 50%;
            border: 4px solid transparent;
            border-top-color: #00FFFF;
            border-right-color: #00BFFF;
            animation: spin 1s linear infinite;
        }

        .loading-ring:nth-child(2) {
            width: 70%;
            height: 70%;
            border-top-color: #00FF64;
            border-right-color: #00FFFF;
            animation: spin 1.5s linear infinite reverse;
        }

        .loading-ring:nth-child(3) {
            width: 40%;
            height: 40%;
            border-top-color: #FFD700;
            border-right-color: #00FF64;
            animation: spin 2s linear infinite;
        }

        .loading-particles {
            position: absolute;
            width: 100%;
            height: 100%;
            animation: spin 3s linear infinite;
        }
        .particle {
            position: absolute;
            width: 8px;
            height: 8px;
            background: #00FFFF;
            border-radius: 50%;
            box-shadow: 0 0 10px #00FFFF, 0 0 20px #00BFFF;
        }

        .particle:nth-child(1) { top: 0; left: 50%; animation: particleFloat 1s ease-in-out infinite; }
        .particle:nth-child(2) { top: 25%; right: 10%; animation: particleFloat 1.2s ease-in-out infinite 0.2s; background: #00FF64; }
        .particle:nth-child(3) { bottom: 25%; left: 10%; animation: particleFloat 1.4s ease-in-out infinite 0.4s; background: #FFD700; }
        .particle:nth-child(4) { bottom: 0; left: 50%; animation: particleFloat 1.1s ease-in-out infinite 0.6s; background: #00BFFF; }

        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        @keyframes particleFloat {
            0%, 100% { opacity: 0.3; transform: scale(0.5); }
            50% { opacity: 1; transform: scale(1.2); }
        }

        .golden-card {
            display: none;
            font-size: 90rem;
            color: #00FFFF;
            animation: zoomBreath 3s ease-in-out infinite;
        }

        @keyframes zoomBreath {
            0%, 100% { 
                transform: scale(1);
                opacity: 0.9;
            }
            50% { 
                transform: scale(1.15);
                opacity: 1;
            }
        }

        .back-btn {
            position: absolute;
            bottom: 30px;
            background: linear-gradient(180deg, #4FD3FF 0%, #00BFFF 100%);
            color: white;
            border: none;
            padding: 15px 40px;
            border-radius: 30px;            font-size: 1.2rem;
            font-weight: bold;
            cursor: pointer;
            box-shadow: 0 0 20px rgba(0, 191, 255, 0.5);
            display: none;
        }

        .back-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 0 30px rgba(0, 191, 255, 0.8);
        }

        @media (max-width: 400px) {
            .key {
                width: min(80px, 18vw);
                height: min(80px, 18vw);
                font-size: min(2.8rem, 5vw);
            }
            .key.suit { font-size: min(3.5rem, 7vw); }
            .key.predict { width: min(180px, 40vw); font-size: min(2rem, 4vw); }
            .key.predict.predict-giant { font-size: min(3rem, 6vw); }
            #displayArea { min-height: 220px; gap: 10px; padding: 20px 25px; }
            .display-card { font-size: clamp(7.5rem, 14vw, 11rem); }
            .golden-card { font-size: min(90rem, 140vw); }
        }
    </style>
</head>
<body>
    <div id="startPage">
        <div class="rotation-container">
            <div class="trail"></div>
            <button class="start-btn" onclick="goToKeyboard()">START</button>
            <div class="comet-tail" id="cometTail"></div>
        </div>
    </div>

    <div id="keyboardPage">
        <div id="displayArea"></div>
        
        <div class="keyboard-container">
            <div class="keyboard-row">
                <button class="key suit" data-suit="â™ " onclick="addChar('â™ ')">â™ </button>
                <button class="key suit hearts" data-suit="â™¥" onclick="addChar('â™¥')">â™¥</button>
                <button class="key suit" data-suit="â™£" onclick="addChar('â™£')">â™£</button>
                <button class="key suit diamonds" data-suit="â™¦" onclick="addChar('â™¦')">â™¦</button>
            </div>

            <div class="keyboard-row">
                <button class="key value-btn" data-value="A" onclick="addChar('A')">A</button>
                <button class="key value-btn" data-value="2" onclick="addChar('2')">2</button>                <button class="key value-btn" data-value="3" onclick="addChar('3')">3</button>
                <button class="key value-btn" data-value="4" onclick="addChar('4')">4</button>
            </div>

            <div class="keyboard-row">
                <button class="key value-btn" data-value="5" onclick="addChar('5')">5</button>
                <button class="key value-btn" data-value="6" onclick="addChar('6')">6</button>
                <button class="key value-btn" data-value="7" onclick="addChar('7')">7</button>
                <button class="key value-btn" data-value="8" onclick="addChar('8')">8</button>
            </div>

            <div class="keyboard-row">
                <button class="key value-btn" data-value="9" onclick="addChar('9')">9</button>
                <button class="key value-btn" data-value="10" onclick="addChar('10')">10</button>
                <button class="key value-btn" data-value="J" onclick="addChar('J')">J</button>
                <button class="key value-btn" data-value="Q" onclick="addChar('Q')">Q</button>
            </div>

            <div class="keyboard-row">
                <button class="key value-btn" data-value="K" onclick="addChar('K')">K</button>
                <button class="key predict" id="predictBtn" onclick="predict()">PREDICT</button>
            </div>
        </div>
    </div>

    <div id="predictPage">
        <div class="loading-container" id="loadingContainer">
            <div class="loading-ring"></div>
            <div class="loading-ring"></div>
            <div class="loading-ring"></div>
            <div class="loading-particles">
                <div class="particle"></div>
                <div class="particle"></div>
                <div class="particle"></div>
                <div class="particle"></div>
            </div>
        </div>
        <div class="golden-card" id="goldenCard">ðŸ‚ </div>
        <button class="back-btn" id="backBtn" onclick="backToKeyboard()">RETOUR</button>
    </div>

    <script>
        var savedCards = [];
        var currentX = null;
        var currentY = null;
        var maxSavedCards = 4;
        var values = ['A', '2', '3', '4', '5', '6', '7', '8', '9', '10', 'J', 'Q', 'K'];
        var suits = ['â™ ', 'â™¥', 'â™£', 'â™¦'];
        var cometTailRotation = 0;
        var cardEmojis = {
            'Aâ™ ': 'ðŸ‚¡', '2â™ ': 'ðŸ‚¢', '3â™ ': 'ðŸ‚£', '4â™ ': 'ðŸ‚¤', '5â™ ': 'ðŸ‚¥',
            '6â™ ': 'ðŸ‚¦', '7â™ ': 'ðŸ‚§', '8â™ ': 'ðŸ‚¨', '9â™ ': 'ðŸ‚©', '10â™ ': 'ðŸ‚ª',
            'Jâ™ ': 'ðŸ‚«', 'Qâ™ ': 'ðŸ‚­', 'Kâ™ ': 'ðŸ‚¬',
            'Aâ™¥': 'ðŸ‚±', '2â™¥': 'ðŸ‚²', '3â™¥': 'ðŸ‚³', '4â™¥': 'ðŸ‚´', '5â™¥': 'ðŸ‚µ',
            '6â™¥': 'ðŸ‚¶', '7â™¥': 'ðŸ‚·', '8â™¥': 'ðŸ‚¸', '9â™¥': 'ðŸ‚¹', '10â™¥': 'ðŸ‚º',
            'Jâ™¥': 'ðŸ‚»', 'Qâ™¥': 'ðŸ‚½', 'Kâ™¥': 'ðŸ‚¼',
            'Aâ™£': 'ðŸƒ‘', '2â™£': 'ðŸƒ’', '3â™£': 'ðŸƒ“', '4â™£': 'ðŸƒ”', '5â™£': 'ðŸƒ•',
            '6â™£': 'ðŸƒ–', '7â™£': 'ðŸƒ—', '8â™£': 'ðŸƒ˜', '9â™£': 'ðŸƒ™', '10â™£': 'ðŸƒš',
            'Jâ™£': 'ðŸƒ›', 'Qâ™£': 'ðŸƒ', 'Kâ™£': 'ðŸƒœ',
            'Aâ™¦': 'ðŸƒ', '2â™¦': 'ðŸƒ‚', '3â™¦': 'ðŸƒƒ', '4â™¦': 'ðŸƒ„', '5â™¦': 'ðŸƒ…',
            '6â™¦': 'ðŸƒ†', '7â™¦': 'ðŸƒ‡', '8â™¦': 'ðŸƒˆ', '9â™¦': 'ðŸƒ‰', '10â™¦': 'ðŸƒŠ',
            'Jâ™¦': 'ðŸƒ‹', 'Qâ™¦': 'ðŸƒ', 'Kâ™¦': 'ðŸƒŒ'
        };

        function trackCometRotation() {
            var cometTail = document.getElementById('cometTail');
            if (cometTail) {
                var style = window.getComputedStyle(cometTail);
                var matrix = style.transform;
                if (matrix !== 'none') {
                    var values_matrix = matrix.split('(')[1].split(')')[0].split(',');
                    var a = values_matrix[0];
                    var b = values_matrix[1];
                    var angleInRadians = Math.atan2(b, a);
                    cometTailRotation = (angleInRadians * (180 / Math.PI) + 360) % 360;
                }
            }
            requestAnimationFrame(trackCometRotation);
        }

        trackCometRotation();

        function goToKeyboard() {
            var predictBtn = document.getElementById('predictBtn');
            if (predictBtn) {
                if (cometTailRotation >= 0 && cometTailRotation < 180) {
                    predictBtn.classList.add('predict-giant');
                } else {
                    predictBtn.classList.remove('predict-giant');
                }
            }
            document.getElementById('startPage').style.display = 'none';
            document.getElementById('keyboardPage').style.display = 'flex';
            savedCards = [];
            currentX = null;
            currentY = null;
            updateXButtonAnimation();
            updateYButtonAnimation();
            updateDisplay();            updatePredictButton();
        }

        function updateXButtonAnimation() {
            var allValueBtns = document.querySelectorAll('.value-btn');
            for (var i = 0; i < allValueBtns.length; i++) {
                allValueBtns[i].classList.remove('active-x');
            }
            
            if (currentX !== null) {
                var activeBtn = document.querySelector('.value-btn[data-value="' + currentX + '"]');
                if (activeBtn) {
                    activeBtn.classList.add('active-x');
                }
            }
        }

        function updateYButtonAnimation() {
            var allSuitBtns = document.querySelectorAll('.key.suit');
            for (var i = 0; i < allSuitBtns.length; i++) {
                allSuitBtns[i].classList.remove('active-y');
            }
            
            if (currentY !== null) {
                var activeBtn = document.querySelector('.key.suit[data-suit="' + currentY + '"]');
                if (activeBtn) {
                    activeBtn.classList.add('active-y');
                }
            }
        }

        // âœ… RÃˆGLE PREDICT : 4 emojis DIFFÃ‰RENTS requis pour activer
        function updatePredictButton() {
            var predictBtn = document.getElementById('predictBtn');
            if (!predictBtn) return;
            
            // 1. RÃ©cupÃ©rer toutes les cartes affichÃ©es (MAX 4)
            var displayedCards = [];
            
            // Ajouter les cartes sauvegardÃ©es (MAX 4)
            for (var i = 0; i < Math.min(savedCards.length, maxSavedCards); i++) {
                displayedCards.push(savedCards[i]);
            }
            
            // Ajouter l'aperÃ§u si X+Y existe ET qu'il y a moins de 4 cartes
            if (currentX !== null && currentY !== null && displayedCards.length < maxSavedCards) {
                displayedCards.push(currentX + currentY);
            }
            
            // 2. VÃ©rifier : exactement 4 cartes affichÃ©es ?            var hasFourCards = (displayedCards.length === 4);
            
            // 3. VÃ©rifier : toutes les cartes sont-elles DIFFÃ‰RENTES ?
            var allDifferent = true;
            var uniqueCards = {};
            for (var i = 0; i < displayedCards.length; i++) {
                if (uniqueCards[displayedCards[i]]) {
                    allDifferent = false;
                    break;
                }
                uniqueCards[displayedCards[i]] = true;
            }
            
            console.log('ðŸ”® updatePredictButton - displayedCards:', displayedCards, 'hasFourCards:', hasFourCards, 'allDifferent:', allDifferent);
            
            // 4. Activer PREDICT SEULEMENT si : 4 cartes ET toutes diffÃ©rentes
            if (hasFourCards && allDifferent) {
                predictBtn.classList.add('predict-active');
                console.log('âœ… PREDICT ACTIVÃ‰ (4 cartes diffÃ©rentes)');
            } else {
                predictBtn.classList.remove('predict-active');
                console.log('âŒ PREDICT DÃ‰SACTIVÃ‰');
            }
        }

        function updateDisplay() {
            var display = document.getElementById('displayArea');
            var newContent = '';
            
            // Afficher les cartes sauvegardÃ©es (MAX 4)
            var numToShow = Math.min(savedCards.length, maxSavedCards);
            for (var i = 0; i < numToShow; i++) {
                var cardKey = savedCards[i];
                var cardEmoji = cardEmojis[cardKey] || cardKey;
                var suit = cardKey.slice(-1);
                newContent += '<span class="display-card" data-suit="' + suit + '">' + cardEmoji + '</span>';
            }

            // Afficher l'aperÃ§u si X+Y existe ET moins de 4 cartes
            if (currentX !== null && currentY !== null && savedCards.length < maxSavedCards) {
                var currentCard = currentX + currentY;
                var currentEmoji = cardEmojis[currentCard] || currentCard;
                var isDuplicate = (savedCards.indexOf(currentCard) >= 0);
                var suit = currentCard.slice(-1);
                
                if (isDuplicate) {
                    newContent += '<span class="display-card last-card" data-suit="' + suit + '" style="filter: brightness(0.5);">' + currentEmoji + '</span>';
                } else {
                    newContent += '<span class="display-card last-card" data-suit="' + suit + '">' + currentEmoji + '</span>';
                }            }

            if (display.innerHTML !== newContent) {
                display.innerHTML = newContent;
                attachClickListeners();
            }
        }

        function attachClickListeners() {
            var display = document.getElementById('displayArea');
            var allCards = display.querySelectorAll('.display-card');
            
            for (var i = 0; i < allCards.length; i++) {
                allCards[i].classList.remove('last-card');
                allCards[i].onclick = null;
                allCards[i].ontouchstart = null;
            }
            
            if (allCards.length > 0) {
                var lastCard = allCards[allCards.length - 1];
                lastCard.classList.add('last-card');
                lastCard.onclick = deleteLastCard;
                lastCard.ontouchstart = function(e) {
                    e.preventDefault();
                    deleteLastCard();
                };
            }
        }

        function deleteLastCard() {
            if (currentX !== null && currentY !== null) {
                // Supprimer carte en cours
            } else if (savedCards.length > 0) {
                // Supprimer carte sauvegardÃ©e
                savedCards.pop();
            }
            
            currentX = null;
            currentY = null;
            updateXButtonAnimation();
            updateYButtonAnimation();
            updatePredictButton();
            updateDisplay();
        }

        function addChar(char) {
            if (values.indexOf(char) >= 0) {
                // C'est une valeur (X)
                if (currentX !== null && currentY !== null) {
                    var cardKey = currentX + currentY;                    if (savedCards.indexOf(cardKey) < 0 && savedCards.length < maxSavedCards) {
                        savedCards.push(cardKey);
                    }
                }
                currentX = char;
                currentY = null;
                
                updateXButtonAnimation();
                updateYButtonAnimation();
                updatePredictButton();
                updateDisplay();
                
            } else if (suits.indexOf(char) >= 0) {
                // C'est une enseigne (Y)
                if (currentX !== null) {
                    currentY = char;
                    updateXButtonAnimation();
                    updateYButtonAnimation();
                    updatePredictButton();
                    updateDisplay();
                }
            }
        }

        function predict() {
            // VÃ©rification de sÃ©curitÃ© : 4 cartes DIFFÃ‰RENTES requises
            var displayedCards = [];
            for (var i = 0; i < Math.min(savedCards.length, maxSavedCards); i++) {
                displayedCards.push(savedCards[i]);
            }
            if (currentX !== null && currentY !== null && displayedCards.length < maxSavedCards) {
                displayedCards.push(currentX + currentY);
            }
            
            var hasFourCards = (displayedCards.length === 4);
            var allDifferent = true;
            var uniqueCards = {};
            for (var i = 0; i < displayedCards.length; i++) {
                if (uniqueCards[displayedCards[i]]) {
                    allDifferent = false;
                    break;
                }
                uniqueCards[displayedCards[i]] = true;
            }
            
            if (!hasFourCards || !allDifferent) {
                console.log('âŒ PREDICT refusÃ©: hasFourCards:', hasFourCards, 'allDifferent:', allDifferent);
                return;
            }
                        console.log('âœ… PREDICT acceptÃ©!');
            
            // Ouvrir page PREDICT
            document.getElementById('keyboardPage').style.display = 'none';
            document.getElementById('predictPage').style.display = 'flex';
            
            document.getElementById('loadingContainer').style.display = 'flex';
            document.getElementById('goldenCard').style.display = 'none';
            document.getElementById('backBtn').style.display = 'none';
            
            setTimeout(function() {
                document.getElementById('loadingContainer').style.display = 'none';
                document.getElementById('goldenCard').style.display = 'block';
                document.getElementById('backBtn').style.display = 'block';
            }, 4000);
        }

        function backToKeyboard() {
            document.getElementById('predictPage').style.display = 'none';
            document.getElementById('keyboardPage').style.display = 'flex';
            updateDisplay();
        }
    </script>
</body>
</html>
