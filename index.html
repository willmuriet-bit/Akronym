<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes">
    <meta name="theme-color" content="#0a0a2e">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Akronym">
    <link rel="manifest" href="manifest.json">
    <link rel="apple-touch-icon" href="small-192.png">
    <title>Akronym</title>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            -webkit-tap-highlight-color: transparent;
            -webkit-touch-callout: none;
        }

        body, html {
            height: 100%;
            width: 100%;
            font-family: 'Arial', sans-serif;
            overflow: hidden;
            position: fixed;
        }

        body {
            background-color: #0a0a2e;
            background-image: url('background.jpg');
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        #startPage {
            position: relative;
            width: 100%;
            height: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .rotation-container {            position: relative;
            width: 300px;
            height: 300px;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .comet-tail {
            position: absolute;
            width: 300px;
            height: 300px;
            top: 50%;
            left: 50%;
            margin-top: -150px;
            margin-left: -150px;
            animation: rotateOnEdge 20s linear infinite;
            z-index: 15;
            pointer-events: none;
        }

        .comet-tail::before {
            content: '';
            position: absolute;
            width: 100%;
            height: 100%;
            border-radius: 50%;
            background: conic-gradient(
                from 0deg,
                rgba(0, 255, 255, 1) 0deg,
                rgba(0, 255, 255, 0.9) 20deg,
                rgba(0, 255, 255, 0.7) 40deg,
                rgba(0, 191, 255, 0.5) 60deg,
                rgba(0, 191, 255, 0.3) 80deg,
                rgba(0, 191, 255, 0.15) 100deg,
                transparent 180deg
            );
            filter: blur(15px);
            transform: rotate(-90deg);
            pointer-events: none;
        }

        .comet-tail::after {
            content: '';
            position: absolute;
            width: 100%;
            height: 100%;
            border-radius: 50%;
            background: conic-gradient(
                from 0deg,                rgba(0, 255, 255, 1) 0deg,
                rgba(0, 255, 255, 0.8) 15deg,
                rgba(0, 191, 255, 0.5) 40deg,
                transparent 90deg
            );
            filter: blur(10px);
            transform: rotate(-90deg);
            opacity: 0.9;
            pointer-events: none;
        }

        .trail {
            position: absolute;
            width: 100%;
            height: 100%;
            border: 2px dashed rgba(0, 191, 255, 0.5);
            border-radius: 50%;
            box-sizing: border-box;
            z-index: 5;
            box-shadow: 0 0 15px rgba(0, 191, 255, 0.6);
            pointer-events: none;
        }

        .start-btn {
            position: relative;
            z-index: 10;
            background: linear-gradient(180deg, #4FD3FF 0%, #00BFFF 40%, #0080FF 100%);
            color: white;
            border: none;
            width: 300px;
            height: 300px;
            border-radius: 50%;
            font-size: 3rem;
            font-weight: bold;
            letter-spacing: 5px;
            cursor: pointer;
            box-shadow: 
                0 10px 30px rgba(0, 0, 0, 0.5),
                0 20px 60px rgba(0, 0, 0, 0.4),
                inset 0 -8px 15px rgba(0, 0, 0, 0.4),
                inset 0 8px 15px rgba(255, 255, 255, 0.5),
                inset 0 0 0 8px rgba(200, 200, 200, 0.8),
                inset 0 0 0 12px rgba(100, 100, 100, 0.6),
                inset 0 0 30px rgba(255, 255, 255, 0.3);
            transition: all 0.3s ease;
            text-shadow: 0 3px 6px rgba(0, 0, 0, 0.4);
            outline: none;
            -webkit-tap-highlight-color: transparent;
            user-select: none;
            -webkit-user-select: none;        }

        .start-btn:hover {
            transform: scale(1.02);
        }

        .start-btn:active {
            transform: scale(0.98);
        }

        @keyframes rotateOnEdge {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        #keyboardPage {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: #0a0a2e;
            background-image: url('background.jpg');
            background-size: cover;
            background-position: center;
            z-index: 100;
            flex-direction: column;
            align-items: center;
            justify-content: flex-start;
            padding: 5px;
        }

        #displayArea {
            width: 95vw;
            max-width: 700px;
            min-height: 220px;
            background: rgba(0, 0, 0, 0.7);
            border: 3px solid rgba(0, 191, 255, 0.6);
            border-radius: 15px;
            margin: 10px 0;
            padding: 20px 25px;
            font-size: 5rem;
            color: #00FFFF;
            text-align: center;
            box-shadow: 0 0 40px rgba(0, 191, 255, 0.4);
            display: flex;
            align-items: center;
            justify-content: center;
            flex-wrap: nowrap;            gap: 5px;
            line-height: 1;
            overflow-x: auto;
            overflow-y: hidden;
        }

        .display-card {
            font-size: clamp(7.5rem, 14vw, 11rem);
            display: inline-block;
            line-height: 1;
            min-width: 0;
            flex-shrink: 0;
            white-space: nowrap;
            user-select: none;
            -webkit-user-select: none;
        }

        .display-card[data-suit="â™¥"],
        .display-card[data-suit="â™¦"] {
            color: #FF0000;
        }

        .display-card[data-suit="â™ "],
        .display-card[data-suit="â™£"] {
            color: #FFFFFF;
        }

        .display-card.last-card {
            cursor: pointer;
            filter: brightness(1.3);
            transition: all 0.2s ease;
        }

        .display-card.last-card:hover {
            transform: scale(1.1);
            filter: brightness(1.5);
        }

        .display-card.last-card:active {
            transform: scale(0.9);
        }

        .keyboard-container {
            background: rgba(0, 0, 0, 0.6);
            padding: 15px;
            border-radius: 15px;
            border: 2px solid rgba(0, 191, 255, 0.4);
            box-shadow: 0 0 50px rgba(0, 191, 255, 0.3);
            width: 95vw;
            max-width: 700px;        }

        .keyboard-row {
            display: flex;
            justify-content: center;
            margin-bottom: 10px;
            gap: 10px;
            flex-wrap: wrap;
        }

        .key {
            background: rgba(0, 0, 0, 0.8);
            border: 2px solid #00BFFF;
            border-radius: 50%;
            color: white;
            font-size: 2.8rem;
            font-weight: bold;
            width: 80px;
            height: 80px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 0 15px rgba(0, 191, 255, 0.3);
            position: relative;
            overflow: hidden;
            user-select: none;
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            outline: none;
            -webkit-tap-highlight-color: transparent;
            -webkit-focus-ring-color: transparent;
        }

        .key::before {
            content: '';
            position: absolute;
            width: 150%;
            height: 150%;
            border-radius: 50%;
            background: radial-gradient(circle, rgba(0, 191, 255, 0.7) 0%, rgba(0, 191, 255, 0.3) 40%, transparent 70%);
            opacity: 0;
            transform: scale(0.3);
            transition: all 0.3s ease;
        }

        .key:hover::before {
            opacity: 1;
            transform: scale(1);        }

        .key:hover {
            transform: scale(1.1);
            box-shadow: 0 0 40px rgba(0, 191, 255, 0.8), 0 0 60px rgba(0, 191, 255, 0.5);
        }

        .key:active {
            transform: scale(0.95);
        }

        .key:focus,
        .key:focus-visible {
            outline: none;
            box-shadow: 0 0 15px rgba(0, 191, 255, 0.3);
        }

        .key.active-x {
            animation: pulseBlue 2s infinite;
        }

        .key.active-x::before {
            opacity: 1;
            transform: scale(1);
        }

        .key.active-x {
            box-shadow: 0 0 40px rgba(0, 191, 255, 0.8), 0 0 60px rgba(0, 191, 255, 0.5);
        }

        @keyframes pulseBlue {
            0%, 100% {
                box-shadow: 0 0 40px rgba(0, 191, 255, 0.8), 0 0 60px rgba(0, 191, 255, 0.5);
            }
            50% {
                box-shadow: 0 0 60px rgba(0, 191, 255, 1), 0 0 80px rgba(0, 191, 255, 0.7);
            }
        }

        .key.suit {
            font-size: 3.5rem;
        }

        .key.suit::before {
            content: '';
            position: absolute;
            width: 150%;
            height: 150%;
            border-radius: 50%;
            opacity: 0;            transform: scale(0.3);
            transition: all 0.1s ease;
        }

        .key.suit:not(.hearts):not(.diamonds)::before {
            background: radial-gradient(circle, rgba(255, 255, 255, 0.9) 0%, rgba(255, 255, 255, 0.5) 40%, transparent 70%);
        }

        .key.suit:not(.hearts):not(.diamonds):active::before {
            opacity: 1;
            transform: scale(1);
        }

        .key.suit:not(.hearts):not(.diamonds):active {
            transform: scale(0.95);
            box-shadow: 0 0 40px rgba(255, 255, 255, 0.9), 0 0 60px rgba(255, 255, 255, 0.6);
        }

        .key.hearts::before {
            background: radial-gradient(circle, rgba(255, 0, 0, 0.9) 0%, rgba(255, 0, 0, 0.5) 40%, transparent 70%);
        }

        .key.hearts:active::before {
            opacity: 1;
            transform: scale(1);
        }

        .key.hearts:active {
            transform: scale(0.95);
            box-shadow: 0 0 40px rgba(255, 0, 0, 0.9), 0 0 60px rgba(255, 0, 0, 0.6);
        }

        .key.diamonds::before {
            background: radial-gradient(circle, rgba(255, 0, 0, 0.9) 0%, rgba(255, 0, 0, 0.5) 40%, transparent 70%);
        }

        .key.diamonds:active::before {
            opacity: 1;
            transform: scale(1);
        }

        .key.diamonds:active {
            transform: scale(0.95);
            box-shadow: 0 0 40px rgba(255, 0, 0, 0.9), 0 0 60px rgba(255, 0, 0, 0.6);
        }

        .key.active-y {
            animation: pulseY 2s infinite;
        }
        .key.active-y::before {
            opacity: 1;
            transform: scale(1);
        }

        @keyframes pulseY {
            0%, 100% {
                box-shadow: 0 0 40px rgba(255, 255, 255, 0.8), 0 0 60px rgba(255, 255, 255, 0.5);
            }
            50% {
                box-shadow: 0 0 60px rgba(255, 255, 255, 1), 0 0 80px rgba(255, 255, 255, 0.7);
            }
        }

        .key.hearts.active-y {
            animation: pulseYRed 2s infinite;
        }

        @keyframes pulseYRed {
            0%, 100% {
                box-shadow: 0 0 40px rgba(255, 0, 0, 0.8), 0 0 60px rgba(255, 0, 0, 0.5);
            }
            50% {
                box-shadow: 0 0 60px rgba(255, 0, 0, 1), 0 0 80px rgba(255, 0, 0, 0.7);
            }
        }

        .key.hearts {
            color: #FF0000;
            border-color: #FF0000;
            box-shadow: 0 0 15px rgba(255, 0, 0, 0.3);
        }

        .key.diamonds {
            color: #FF0000;
            border-color: #FF0000;
            box-shadow: 0 0 15px rgba(255, 0, 0, 0.3);
        }

        .key.predict {
            width: 180px;
            border-radius: 40px;
            font-size: 2rem;
            background: linear-gradient(180deg, rgba(0, 255, 100, 0.3) 0%, rgba(0, 200, 80, 0.3) 100%);
            border-color: #00FF64;
            color: #00FF64;
            transition: all 0.5s ease;
            pointer-events: none;
            opacity: 0.5;
            cursor: not-allowed;        }

        .key.predict.predict-giant {
            font-size: 3rem;
        }

        .key.predict.predict-active {
            background: linear-gradient(180deg, rgba(0, 255, 100, 0.6) 0%, rgba(0, 200, 80, 0.6) 100%);
            box-shadow: 0 0 40px rgba(0, 255, 100, 0.8), 0 0 60px rgba(0, 255, 100, 0.5);
            animation: pulsePredict 1.5s infinite;
            pointer-events: auto;
            opacity: 1;
            cursor: pointer;
        }

        @keyframes pulsePredict {
            0%, 100% {
                box-shadow: 0 0 40px rgba(0, 255, 100, 0.8), 0 0 60px rgba(0, 255, 100, 0.5);
            }
            50% {
                box-shadow: 0 0 60px rgba(0, 255, 100, 1), 0 0 80px rgba(0, 255, 100, 0.7);
            }
        }

        .key.predict::before {
            background: radial-gradient(ellipse, rgba(0, 255, 100, 0.7) 0%, rgba(0, 255, 100, 0.3) 40%, transparent 70%);
        }

        .key.predict:hover {
            background: linear-gradient(180deg, rgba(0, 255, 100, 0.5) 0%, rgba(0, 200, 80, 0.5) 100%);
            box-shadow: 0 0 40px rgba(0, 255, 100, 0.8), 0 0 60px rgba(0, 255, 100, 0.5);
        }

        #predictPage {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: #0a0a2e;
            background-image: url('background.jpg');
            background-size: cover;
            background-position: center;
            z-index: 200;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }
        .loading-container {
            position: relative;
            width: 200px;
            height: 200px;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .loading-ring {
            position: absolute;
            width: 100%;
            height: 100%;
            border-radius: 50%;
            border: 4px solid transparent;
            border-top-color: #00FFFF;
            border-right-color: #00BFFF;
            animation: spin 1s linear infinite;
        }

        .loading-ring:nth-child(2) {
            width: 70%;
            height: 70%;
            border-top-color: #00FF64;
            border-right-color: #00FFFF;
            animation: spin 1.5s linear infinite reverse;
        }

        .loading-ring:nth-child(3) {
            width: 40%;
            height: 40%;
            border-top-color: #FFD700;
            border-right-color: #00FF64;
            animation: spin 2s linear infinite;
        }

        .loading-particles {
            position: absolute;
            width: 100%;
            height: 100%;
            animation: spin 3s linear infinite;
        }

        .particle {
            position: absolute;
            width: 8px;
            height: 8px;
            background: #00FFFF;
            border-radius: 50%;
            box-shadow: 0 0 10px #00FFFF, 0 0 20px #00BFFF;        }

        .particle:nth-child(1) { top: 0; left: 50%; animation: particleFloat 1s ease-in-out infinite; }
        .particle:nth-child(2) { top: 25%; right: 10%; animation: particleFloat 1.2s ease-in-out infinite 0.2s; background: #00FF64; }
        .particle:nth-child(3) { bottom: 25%; left: 10%; animation: particleFloat 1.4s ease-in-out infinite 0.4s; background: #FFD700; }
        .particle:nth-child(4) { bottom: 0; left: 50%; animation: particleFloat 1.1s ease-in-out infinite 0.6s; background: #00BFFF; }

        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        @keyframes particleFloat {
            0%, 100% { opacity: 0.3; transform: scale(0.5); }
            50% { opacity: 1; transform: scale(1.2); }
        }

        .card-flip-container {
            display: block;
            width: 300px;
            height: 450px;
            perspective: 1000px;
            cursor: pointer;
            animation: zoomBreath 3s ease-in-out infinite;
            margin: 0 auto;
            position: relative;
            user-select: none;
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            -webkit-tap-highlight-color: transparent;
            -webkit-touch-callout: none;
            outline: none;
        }

        .card-flip-inner {
            position: relative;
            width: 100%;
            height: 100%;
            transition: transform 0.8s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            transform-style: preserve-3d;
            user-select: none;
            -webkit-user-select: none;
            -webkit-tap-highlight-color: transparent;
            outline: none;
        }

        .card-emoji {
            position: absolute;
            width: 100%;            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 33rem;
            backface-visibility: hidden;
            -webkit-backface-visibility: hidden;
            background: transparent;
            user-select: none;
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            -webkit-touch-callout: none;
            -webkit-tap-highlight-color: transparent;
            outline: none;
        }

        .card-emoji.back {
            color: #00FFFF;
        }

        .card-emoji.face {
            color: #FF0000;
            transform: rotateY(180deg);
        }

        @keyframes zoomBreath {
            0%, 100% { 
                transform: scale(1);
                opacity: 0.9;
            }
            50% { 
                transform: scale(1.15);
                opacity: 1;
            }
        }

        @media (max-width: 400px) {
            .key {
                width: min(80px, 18vw);
                height: min(80px, 18vw);
                font-size: min(2.8rem, 5vw);
            }
            .key.suit { font-size: min(3.5rem, 7vw); }
            .key.predict { width: min(180px, 40vw); font-size: min(2rem, 4vw); }
            .key.predict.predict-giant { font-size: min(3rem, 6vw); }
            #displayArea { min-height: 220px; gap: 5px; padding: 20px 25px; }
            .display-card { font-size: clamp(7.5rem, 14vw, 11rem); }
            .card-flip-container { width: 250px; height: 375px; }
            .card-emoji { font-size: 27rem; }        }
    </style>
</head>
<body>
    <div id="startPage">
        <div class="rotation-container">
            <div class="trail"></div>
            <button class="start-btn" id="startBtn">START</button>
            <div class="comet-tail" id="cometTail"></div>
        </div>
    </div>

    <div id="keyboardPage">
        <div id="displayArea"></div>
        
        <div class="keyboard-container">
            <div class="keyboard-row">
                <button class="key suit" data-suit="â™ " onclick="addChar('â™ ')">â™ </button>
                <button class="key suit hearts" data-suit="â™¥" onclick="addChar('â™¥')">â™¥</button>
                <button class="key suit" data-suit="â™£" onclick="addChar('â™£')">â™£</button>
                <button class="key suit diamonds" data-suit="â™¦" onclick="addChar('â™¦')">â™¦</button>
            </div>

            <div class="keyboard-row">
                <button class="key value-btn" data-value="A" onclick="addChar('A')">A</button>
                <button class="key value-btn" data-value="2" onclick="addChar('2')">2</button>
                <button class="key value-btn" data-value="3" onclick="addChar('3')">3</button>
                <button class="key value-btn" data-value="4" onclick="addChar('4')">4</button>
            </div>

            <div class="keyboard-row">
                <button class="key value-btn" data-value="5" onclick="addChar('5')">5</button>
                <button class="key value-btn" data-value="6" onclick="addChar('6')">6</button>
                <button class="key value-btn" data-value="7" onclick="addChar('7')">7</button>
                <button class="key value-btn" data-value="8" onclick="addChar('8')">8</button>
            </div>

            <div class="keyboard-row">
                <button class="key value-btn" data-value="9" onclick="addChar('9')">9</button>
                <button class="key value-btn" data-value="10" onclick="addChar('10')">10</button>
                <button class="key value-btn" data-value="J" onclick="addChar('J')">J</button>
                <button class="key value-btn" data-value="Q" onclick="addChar('Q')">Q</button>
            </div>

            <div class="keyboard-row">
                <button class="key value-btn" data-value="K" onclick="addChar('K')">K</button>
                <button class="key predict" id="predictBtn" onclick="predict()">PREDICT</button>
            </div>
        </div>
    </div>
    <div id="predictPage">
        <div class="loading-container" id="loadingContainer">
            <div class="loading-ring"></div>
            <div class="loading-ring"></div>
            <div class="loading-ring"></div>
            <div class="loading-particles">
                <div class="particle"></div>
                <div class="particle"></div>
                <div class="particle"></div>
                <div class="particle"></div>
            </div>
        </div>
        
        <div class="card-flip-container" id="cardFlipContainer" onclick="flipCard()">
            <div class="card-flip-inner" id="cardFlipInner">
                <div class="card-emoji back" id="cardBack">ðŸ‚ </div>
                <div class="card-emoji face" id="cardFace">ðŸƒŠ</div>
            </div>
        </div>
    </div>

    <script>
        var savedCards = [];
        var currentX = null;
        var currentY = null;
        var maxSavedCards = 4;
        var values = ['A', '2', '3', '4', '5', '6', '7', '8', '9', '10', 'J', 'Q', 'K'];
        var suits = ['â™ ', 'â™¥', 'â™£', 'â™¦'];
        var cometTailRotation = 0;
        var startRotation = 0;
        var isFlipped = false;
        var isFlipping = false;
        var stock = [];
        var reveal = '10â™¦';
        var lastTapTime = 0;
        var longPressTimer = null;
        var longPressDuration = 500;

        var basicOrder = [
            'Aâ™ ', 'Aâ™¥', 'Aâ™£', 'Aâ™¦',
            '2â™ ', '2â™¥', '2â™£', '2â™¦',
            '3â™ ', '3â™¥', '3â™£', '3â™¦',
            '4â™ ', '4â™¥', '4â™£', '4â™¦',
            '5â™ ', '5â™¥', '5â™£', '5â™¦',
            '6â™ ', '6â™¥', '6â™£', '6â™¦',
            '7â™ ', '7â™¥', '7â™£', '7â™¦',
            '8â™ ', '8â™¥', '8â™£', '8â™¦',
            '9â™ ', '9â™¥', '9â™£', '9â™¦',
            '10â™ ', '10â™¥', '10â™£', '10â™¦',            'Jâ™ ', 'Jâ™¥', 'Jâ™£', 'Jâ™¦',
            'Qâ™ ', 'Qâ™¥', 'Qâ™£', 'Qâ™¦',
            'Kâ™ ', 'Kâ™¥', 'Kâ™£', 'Kâ™¦'
        ];

        var highcards = {
            '7â™ ': '4321', '7â™¥': '3421', '7â™£': '2431', '7â™¦': '1432',
            '8â™ ': '4213', '8â™¥': '3214', '8â™£': '2314', '8â™¦': '1324',
            '9â™ ': '4132', '9â™¥': '3142', '9â™£': '2143', '9â™¦': '1243',
            '10â™ ': '4312', '10â™¥': '3412', '10â™£': '2413', '10â™¦': '1423',
            'Jâ™ ': '4231', 'Jâ™¥': '3241', 'Jâ™£': '2341', 'Jâ™¦': '1342',
            'Qâ™ ': '4123', 'Qâ™¥': '3124', 'Qâ™£': '2134', 'Qâ™¦': '1234'
        };

        var lowcards = {
            'Aâ™ ': '4321', 'Aâ™¥': '3421', 'Aâ™£': '2431', 'Aâ™¦': '1432',
            '2â™ ': '4213', '2â™¥': '3214', '2â™£': '2314', '2â™¦': '1324',
            '3â™ ': '4132', '3â™¥': '3142', '3â™£': '2143', '3â™¦': '1243',
            '4â™ ': '4312', '4â™¥': '3412', '4â™£': '2413', '4â™¦': '1423',
            '5â™ ': '4231', '5â™¥': '3241', '5â™£': '2341', '5â™¦': '1342',
            '6â™ ': '4123', '6â™¥': '3124', '6â™£': '2134', '6â™¦': '1234'
        };

        var kingsorder = ['Kâ™ ', 'Kâ™¥', 'Kâ™£', 'Kâ™¦'];

        var cardEmojis = {
            'Aâ™ ': 'ðŸ‚¡', 'Aâ™¥': 'ðŸ‚±', 'Aâ™£': 'ðŸƒ‘', 'Aâ™¦': 'ðŸƒ',
            '2â™ ': 'ðŸ‚¢', '2â™¥': 'ðŸ‚²', '2â™£': 'ðŸƒ’', '2â™¦': 'ðŸƒ‚',
            '3â™ ': 'ðŸ‚£', '3â™¥': 'ðŸ‚³', '3â™£': 'ðŸƒ“', '3â™¦': 'ðŸƒƒ',
            '4â™ ': 'ðŸ‚¤', '4â™¥': 'ðŸ‚´', '4â™£': 'ðŸƒ”', '4â™¦': 'ðŸƒ„',
            '5â™ ': 'ðŸ‚¥', '5â™¥': 'ðŸ‚µ', '5â™£': 'ðŸƒ•', '5â™¦': 'ðŸƒ…',
            '6â™ ': 'ðŸ‚¦', '6â™¥': 'ðŸ‚¶', '6â™£': 'ðŸƒ–', '6â™¦': 'ðŸƒ†',
            '7â™ ': 'ðŸ‚§', '7â™¥': 'ðŸ‚·', '7â™£': 'ðŸƒ—', '7â™¦': 'ðŸƒ‡',
            '8â™ ': 'ðŸ‚¨', '8â™¥': 'ðŸ‚¸', '8â™£': 'ðŸƒ˜', '8â™¦': 'ðŸƒˆ',
            '9â™ ': 'ðŸ‚©', '9â™¥': 'ðŸ‚¹', '9â™£': 'ðŸƒ™', '9â™¦': 'ðŸƒ‰',
            '10â™ ': 'ðŸ‚ª', '10â™¥': 'ðŸ‚º', '10â™£': 'ðŸƒš', '10â™¦': 'ðŸƒŠ',
            'Jâ™ ': 'ðŸ‚«', 'Jâ™¥': 'ðŸ‚»', 'Jâ™£': 'ðŸƒ›', 'Jâ™¦': 'ðŸƒ‹',
            'Qâ™ ': 'ðŸ‚­', 'Qâ™¥': 'ðŸ‚½', 'Qâ™£': 'ðŸƒ', 'Qâ™¦': 'ðŸƒ',
            'Kâ™ ': 'ðŸ‚¬', 'Kâ™¥': 'ðŸ‚¼', 'Kâ™£': 'ðŸƒœ', 'Kâ™¦': 'ðŸƒŒ'
        };

        function goToKeyboard() {
            var predictBtn = document.getElementById('predictBtn');
            if (predictBtn) {
                if (cometTailRotation >= 0 && cometTailRotation < 180) {
                    predictBtn.classList.add('predict-giant');
                } else {
                    predictBtn.classList.remove('predict-giant');
                }
            }            document.getElementById('startPage').style.display = 'none';
            document.getElementById('keyboardPage').style.display = 'flex';
            savedCards = [];
            currentX = null;
            currentY = null;
            isFlipped = false;
            isFlipping = false;
            stock = [];
            reveal = '10â™¦';
            updateXButtonAnimation();
            updateYButtonAnimation();
            updateDisplay();
            updatePredictButton();
        }

        window.addEventListener('load', function() {
            var startBtn = document.getElementById('startBtn');
            if (startBtn) {
                startBtn.onclick = goToKeyboard;
            }
            initDoubleTap();
            initLongPress();
            trackCometRotation();
            
            // âœ… PWA Service Worker Registration
            if ('serviceWorker' in navigator) {
                navigator.serviceWorker.register('/sw.js')
                    .then(registration => {
                        console.log('ServiceWorker registration successful');
                    })
                    .catch(err => {
                        console.log('ServiceWorker registration failed: ', err);
                    });
            }
        });

        function initDoubleTap() {
            var predictPage = document.getElementById('predictPage');
            if (predictPage) {
                predictPage.addEventListener('click', handleDoubleTap);
            }
        }

        function handleDoubleTap(e) {
            var currentTime = new Date().getTime();
            var tapLength = currentTime - lastTapTime;
            if (tapLength < 300 && tapLength > 0) {
                e.preventDefault();
                exitToStart(0);
                lastTapTime = 0;            } else {
                lastTapTime = currentTime;
            }
        }

        function initLongPress() {
            var predictPage = document.getElementById('predictPage');
            if (predictPage) {
                predictPage.addEventListener('touchstart', handleLongPressStart, { passive: false });
                predictPage.addEventListener('touchend', handleLongPressEnd);
                predictPage.addEventListener('mousedown', handleLongPressStart);
                predictPage.addEventListener('mouseup', handleLongPressEnd);
                predictPage.addEventListener('mouseleave', handleLongPressEnd);
            }
        }

        function handleLongPressStart(e) {
            longPressTimer = setTimeout(function() {
                exitToStart(180);
            }, longPressDuration);
        }

        function handleLongPressEnd(e) {
            if (longPressTimer) {
                clearTimeout(longPressTimer);
                longPressTimer = null;
            }
        }

        function trackCometRotation() {
            var cometTail = document.getElementById('cometTail');
            if (cometTail) {
                var style = window.getComputedStyle(cometTail);
                var matrix = style.transform;
                if (matrix !== 'none') {
                    var values_matrix = matrix.split('(')[1].split(')')[0].split(',');
                    var a = values_matrix[0];
                    var b = values_matrix[1];
                    var angleInRadians = Math.atan2(b, a);
                    cometTailRotation = (angleInRadians * (180 / Math.PI) + 360) % 360;
                }
            }
            requestAnimationFrame(trackCometRotation);
        }

        function updateXButtonAnimation() {
            var allValueBtns = document.querySelectorAll('.value-btn');
            for (var i = 0; i < allValueBtns.length; i++) {
                allValueBtns[i].classList.remove('active-x');
            }            if (currentX !== null) {
                var activeBtn = document.querySelector('.value-btn[data-value="' + currentX + '"]');
                if (activeBtn) {
                    activeBtn.classList.add('active-x');
                }
            }
        }

        function updateYButtonAnimation() {
            var allSuitBtns = document.querySelectorAll('.key.suit');
            for (var i = 0; i < allSuitBtns.length; i++) {
                allSuitBtns[i].classList.remove('active-y');
            }
            if (currentY !== null) {
                var activeBtn = document.querySelector('.key.suit[data-suit="' + currentY + '"]');
                if (activeBtn) {
                    activeBtn.classList.add('active-y');
                }
            }
        }

        function updatePredictButton() {
            var predictBtn = document.getElementById('predictBtn');
            if (!predictBtn) return;
            var displayedCards = [];
            for (var i = 0; i < Math.min(savedCards.length, maxSavedCards); i++) {
                displayedCards.push(savedCards[i]);
            }
            if (currentX !== null && currentY !== null && displayedCards.length < maxSavedCards) {
                displayedCards.push(currentX + currentY);
            }
            var hasFourCards = (displayedCards.length === 4);
            var allDifferent = true;
            var uniqueCards = {};
            for (var i = 0; i < displayedCards.length; i++) {
                if (uniqueCards[displayedCards[i]]) {
                    allDifferent = false;
                    break;
                }
                uniqueCards[displayedCards[i]] = true;
            }
            if (hasFourCards && allDifferent) {
                predictBtn.classList.add('predict-active');
            } else {
                predictBtn.classList.remove('predict-active');
            }
        }

        function updateDisplay() {
            var display = document.getElementById('displayArea');            if (!display) return;
            var newContent = '';
            var numToShow = Math.min(savedCards.length, maxSavedCards);
            for (var i = 0; i < numToShow; i++) {
                var cardKey = savedCards[i];
                var cardEmoji = cardEmojis[cardKey] || cardKey;
                var suit = cardKey.slice(-1);
                newContent += '<span class="display-card" data-suit="' + suit + '">' + cardEmoji + '</span>';
            }
            if (currentX !== null && currentY !== null && savedCards.length < maxSavedCards) {
                var currentCard = currentX + currentY;
                var currentEmoji = cardEmojis[currentCard] || currentCard;
                var isDuplicate = (savedCards.indexOf(currentCard) >= 0);
                var suit = currentCard.slice(-1);
                if (isDuplicate) {
                    newContent += '<span class="display-card last-card" data-suit="' + suit + '" style="filter: brightness(0.5);">' + currentEmoji + '</span>';
                } else {
                    newContent += '<span class="display-card last-card" data-suit="' + suit + '">' + currentEmoji + '</span>';
                }
            }
            display.innerHTML = newContent;
            attachClickListeners();
        }

        function attachClickListeners() {
            var display = document.getElementById('displayArea');
            if (!display) return;
            var allCards = display.querySelectorAll('.display-card');
            for (var i = 0; i < allCards.length; i++) {
                allCards[i].classList.remove('last-card');
                allCards[i].onclick = null;
                allCards[i].ontouchstart = null;
            }
            if (allCards.length > 0) {
                var lastCard = allCards[allCards.length - 1];
                lastCard.classList.add('last-card');
                lastCard.onclick = deleteLastCard;
                lastCard.ontouchstart = function(e) {
                    e.preventDefault();
                    deleteLastCard();
                };
            }
        }

        function deleteLastCard() {
            if (currentX !== null && currentY !== null) {
            } else if (savedCards.length > 0) {
                savedCards.pop();
            }
            currentX = null;            currentY = null;
            updateXButtonAnimation();
            updateYButtonAnimation();
            updatePredictButton();
            updateDisplay();
        }

        function addChar(char) {
            if (values.indexOf(char) >= 0) {
                if (currentX !== null && currentY !== null) {
                    var cardKey = currentX + currentY;
                    if (savedCards.indexOf(cardKey) < 0 && savedCards.length < maxSavedCards) {
                        savedCards.push(cardKey);
                    }
                }
                currentX = char;
                currentY = null;
                updateXButtonAnimation();
                updateYButtonAnimation();
                updatePredictButton();
                updateDisplay();
            } else if (suits.indexOf(char) >= 0) {
                if (currentX !== null) {
                    currentY = char;
                    updateXButtonAnimation();
                    updateYButtonAnimation();
                    updatePredictButton();
                    updateDisplay();
                }
            }
        }

        function calculateCode() {
            stock = [];
            for (var i = 0; i < Math.min(savedCards.length, maxSavedCards); i++) {
                stock.push(savedCards[i]);
            }
            if (currentX !== null && currentY !== null && stock.length < 4) {
                stock.push(currentX + currentY);
            }
            var cardPositions = [];
            for (var i = 0; i < stock.length; i++) {
                var position = basicOrder.indexOf(stock[i]);
                cardPositions.push({ card: stock[i], position: position, index: i });
            }
            cardPositions.sort(function(a, b) { return a.position - b.position; });
            var cardNumbers = {};
            for (var i = 0; i < cardPositions.length; i++) {
                cardNumbers[cardPositions[i].card] = i + 1;
            }            var codeArray = [];
            for (var i = 0; i < stock.length; i++) {
                codeArray.push(cardNumbers[stock[i]]);
            }
            return codeArray.join('');
        }

        function determineReveal(code) {
            var liste = (startRotation >= 0 && startRotation < 180) ? highcards : lowcards;
            var carteTrouvee = null;
            for (var carte in liste) {
                if (liste[carte] === code) {
                    carteTrouvee = carte;
                    break;
                }
            }
            if (!carteTrouvee) {
                reveal = '10â™¦';
                return;
            }
            if (stock.indexOf(carteTrouvee) === -1) {
                reveal = carteTrouvee;
                return;
            }
            var sortedStock = stock.slice().sort(function(a, b) {
                return basicOrder.indexOf(a) - basicOrder.indexOf(b);
            });
            var currentPosition = sortedStock.indexOf(carteTrouvee) + 1;
            var finalKing = null;
            for (var iteration = 0; iteration < 4; iteration++) {
                var king = kingsorder[currentPosition - 1];
                if (sortedStock.indexOf(king) === -1) {
                    finalKing = king;
                    break;
                }
                currentPosition = sortedStock.indexOf(king) + 1;
            }
            if (finalKing) {
                reveal = finalKing;
            } else {
                reveal = '10â™¦';
            }
        }

        function predict() {
            var displayedCards = [];
            for (var i = 0; i < Math.min(savedCards.length, maxSavedCards); i++) {
                displayedCards.push(savedCards[i]);
            }
            if (currentX !== null && currentY !== null && displayedCards.length < maxSavedCards) {                displayedCards.push(currentX + currentY);
            }
            var hasFourCards = (displayedCards.length === 4);
            var allDifferent = true;
            var uniqueCards = {};
            for (var i = 0; i < displayedCards.length; i++) {
                if (uniqueCards[displayedCards[i]]) {
                    allDifferent = false;
                    break;
                }
                uniqueCards[displayedCards[i]] = true;
            }
            if (!hasFourCards || !allDifferent) {
                return;
            }
            startRotation = cometTailRotation;
            var code = calculateCode();
            determineReveal(code);
            document.getElementById('keyboardPage').style.display = 'none';
            document.getElementById('predictPage').style.display = 'flex';
            document.getElementById('loadingContainer').style.display = 'flex';
            document.getElementById('cardFlipContainer').style.display = 'none';
            isFlipped = false;
            isFlipping = false;
            document.getElementById('cardFlipInner').style.transform = 'rotateY(0deg)';
            document.getElementById('cardBack').style.display = 'flex';
            document.getElementById('cardFace').style.display = 'none';
            setTimeout(function() {
                document.getElementById('loadingContainer').style.display = 'none';
                document.getElementById('cardFlipContainer').style.display = 'block';
                var revealEmoji = cardEmojis[reveal] || 'ðŸƒŠ';
                var revealSuit = reveal.slice(-1);
                var cardFace = document.getElementById('cardFace');
                cardFace.textContent = revealEmoji;
                if (revealSuit === 'â™¥' || revealSuit === 'â™¦') {
                    cardFace.style.color = '#FF0000';
                } else {
                    cardFace.style.color = '#FFFFFF';
                }
            }, 4000);
        }

        function flipCard() {
            if (isFlipping) return;
            var cardInner = document.getElementById('cardFlipInner');
            var cardBack = document.getElementById('cardBack');
            var cardFace = document.getElementById('cardFace');
            isFlipping = true;
            if (!isFlipped) {
                cardInner.style.transform = 'rotateY(180deg)';                setTimeout(function() {
                    cardBack.style.display = 'none';
                    cardFace.style.display = 'flex';
                }, 400);
                isFlipped = true;
            } else {
                cardInner.style.transform = 'rotateY(0deg)';
                setTimeout(function() {
                    cardFace.style.display = 'none';
                    cardBack.style.display = 'flex';
                }, 400);
                isFlipped = false;
            }
            setTimeout(function() { isFlipping = false; }, 800);
        }

        function exitToStart(rotation) {
            document.getElementById('predictPage').style.display = 'none';
            document.getElementById('startPage').style.display = 'flex';
            savedCards = [];
            currentX = null;
            currentY = null;
            isFlipped = false;
            isFlipping = false;
            stock = [];
            reveal = '10â™¦';
            lastTapTime = 0;
            if (longPressTimer) {
                clearTimeout(longPressTimer);
                longPressTimer = null;
            }
            var cometTail = document.getElementById('cometTail');
            if (cometTail) {
                if (rotation === 180) {
                    cometTail.style.animation = 'none';
                    cometTail.offsetHeight;
                    cometTail.style.animation = 'rotateOnEdge 20s linear infinite';
                    cometTail.style.animationDelay = '-10s';
                    cometTailRotation = 180;
                } else {
                    cometTail.style.animation = 'none';
                    cometTail.offsetHeight;
                    cometTail.style.animation = 'rotateOnEdge 20s linear infinite';
                    cometTail.style.animationDelay = '0s';
                    cometTailRotation = 0;
                }
            }
        }
    </script>
</body></html>manifest.json
